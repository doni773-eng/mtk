<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Absensi Siswa</title>
</head>
<body>
  <h2>Absensi Siswa</h2>
  <textarea id="namaSiswa" placeholder="Masukkan nama siswa, pisahkan dengan koma"></textarea>
  <select id="status">
    <option value="Hadir">Hadir</option>
    <option value="Sakit">Sakit</option>
    <option value="Izin">Izin</option>
    <option value="Alpa">Alpa</option>
  </select>
  <button onclick="simpanAbsensi()">Simpan</button>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyLSo54atcJzhgPOLYr9nUj0yZvOaxhSe7Q3Y2KmkE/dev;

    function simpanAbsensi() {
      const namaInput = document.getElementById("namaSiswa").value;
      const status = document.getElementById("status").value;
      const namaArray = namaInput.split(",").map(n => n.trim()).filter(n => n);

      // Simpan ke localStorage
      let absensi = JSON.parse(localStorage.getItem("absensi")) || [];
      namaArray.forEach(nama => absensi.push({nama, status}));
      localStorage.setItem("absensi", JSON.stringify(absensi));

      alert("Data disimpan. Akan dikirim saat online.");
      kirimJikaOnline();
    }

    function kirimJikaOnline() {
      if (navigator.onLine) {
        let absensi = JSON.parse(localStorage.getItem("absensi")) || [];
        if (absensi.length > 0) {
          fetch(WEB_APP_URL, {
            method: "POST",
            body: JSON.stringify(absensi),
            headers: { "Content-Type": "application/json" }
          })
          .then(res => res.json())
          .then(res => {
            if (res.status === "success") {
              alert("Data terkirim ke Spreadsheet!");
              localStorage.removeItem("absensi");
            } else {
              console.error(res.message);
            }
          })
          .catch(err => console.error("Gagal kirim:", err));
        }
      }
    }

    window.addEventListener("online", kirimJikaOnline);
  </script>
</body>
</html>
